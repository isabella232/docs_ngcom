.. _collector:

.. _nextgis.com: http://nextgis.com/
.. _NextGIS Collector: https://play.google.com/store/apps/details?id=com.nextgis.collector

Как начать сбор данных в вашей Веб ГИС
======================================

.. note::
    Описываемая в данном разделе функциональность доступна в веб ГИС, созданной с помощью сервиса nextgis.com_ и
    находящейся на тарифном плане `Премиум <http://nextgis.ru/pricing/#premium/>`_

Введение
--------

Сбор пространственных данных необходим для того, чтобы получить географическую и атрибутивную информацию об объектах,
расположенных на местности. Географическая составляющая описывается координатами. Атрибутивная информация - это
описание характеристик (свойств) объекта.

.. note::
    В качестве **примера** можно привести задачу мониторинга за состоянием объектов дорожной инфраструктуры.
    Дорожно-эксплуатационное предприятие должно осуществлять периодический контроль за состоянием дорожного полотна.
    Соответсвенно объектами для сбора пространственных данных в данном случае выступят повреждения дорожного покрытия.
    Географическая составляющая информации - координаты местоположения таких повреждений. Атрибутивная информация - это
    тип повреждения, его размеры, описание расположения в границах дорожного полотна, фотография повреждения. Для того,
    чтобы упростить процедуру сбора такой информации и предоставить инструмент для сбора таких данных и была разработана
    система NextGIS Collector.

Однако прежде чем перейти к техническому описанию возможностей системы необходимо рассмотреть основных участников
процесса сбора данных для лучшего понимания принципов работы системы.

В процессе сбора пространственных данных можно выделить две роли:

* Организатор сбора данных.
* Участник сбора данных.

.. figure:: _static/ngc-data-collection-team-clt.png
   :name: Абстрактные роли, выделяемые в процессе сбора данных
   :align: center

   Абстрактные роли, выделяемые в процессе сбора данных

В роли *организатора сбора данных* выступает субъект, который организует процесс сбора данных, собирает команду
участников, контролирует процесс и верифицирует полученные данные. В этой роли может выступать как группа людей, так
и отдельный человек. В примере, который был приведен выше, в роли организатора сбора данных выступало
дорожно-эксплуатационное предприятие.

Ниже, приведены примеры организаторов сбора данных и задач, которые у них возникают.

.. figure:: _static/ngc-team-lead.png
   :name: Примеры организаторов сбора данных
   :align: center

   Примеры  организаторов сбора данных

В роли *участника сбора данных* выступает человек, который осуществляет сбор данных на местности. В его задачи входит
описание свойств реального объекта на местности. До активного распространения мобильных устройств сбор данных
осуществлялся с помощью блокнота и письменных принадлежностей. Сегодня мобильные устройства помогают существенно
упростить этот процесс и уменьшить количество ошибок, поэтому предполагается, что каждый участник сбора данных
обеспечен мобильным устройством.


Принципы работы с NextGIS Collector
-----------------------------------

NextGIS Collector - технология, которая создана для упрощения сбора пространственных данных на местности.

NextGIS Collector дает возможность владельцу Веб ГИС, созданной на nextgis.com, организовать команду из
нескольких человек и начать сбор данных с помощью мобильных устройств.

NextGIS Collector представляет собой технологический стек, который призван объединить поток данных между
организатором и участниками сбора данных для эффективного контроля за процессом и облегчения сбора данных
(процесс сбора данных описан в предыдущем разделе).

.. figure:: _static/ngc-data-collection-team-ngc.png
   :name: Место NextGIS Collector среди участников процесса сбора данных
   :align: center

   Место NextGIS Collector среди участников процесса сбора данных

Можно выделить следующие этапы работы, характерные для процесса сбора данных в NextGIS Collector:

1. Организатор сбора регистрируется на nextgis.com_ и создает веб ГИС на тарифном
   плане `Премиум <http://nextgis.ru/pricing/#premium/>`_.
2. Участники команды сбора данных регистрируются на nextgis.com_.
3. Организатор сбора данных добавляет участников команды сбора данных в свою веб ГИС и создает проект сбора данных.
4. Участники команды устанавливают приложение `NextGIS Collector`_ и подключается к проекту.
5. Участники команды начинают сбор данных. Данные автоматически отправляются в Веб ГИС организатора.

Схематически этапы работы c NextGIS Collector можно представить так:

.. raw:: html

   <iframe width="560" height="315" src="https://www.youtube.com/embed/fal_oUeGiLE"
    frameborder="0" allow="accelerometer;
    autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>


Таким образом, для начала сбора данных нужно следующее:

- Организатор сбора данных должен иметь Веб ГИС, которая находится на тарифном
  плане `Премиум <http://nextgis.ru/pricing/#premium/>`_.
- Каждый участник команды по сбору данных должен иметь при себе мобильный телефон на базе ОС Android.
- Каждый участник команды по сбору данных должен быть зарегистрирован в системе nextgis.com_ и
  знать свой email и пароль, которые он использовал при регистрации.


Организатор сбора данных: добавление участников команды в веб ГИС
-----------------------------------------------------------------

Первый этап работы с системой предполагает регистрацию участников команды по
сбору данных в веб ГИС организатора сбора данных. Как было сказано выше,
участники команды по сбору данных должны иметь при себе мобильный телефон на базе ОС Android.
На каждый из телефонов будет установлено мобильное приложение `NextGIS Collector`_ -
оно позволит вносить изменения в данные и синхронизировать эти изменения
с веб ГИС организатора сбора данных.

Кроме того, каждый участник команды по сбору данных должен быть зарегистрирован
на сервисе nextgis.com_. Участник команды может сделать это самостоятельно
и передать организатору сбора данных свой логин. Логин nextgis.com_ - это e-mail,
который участник использовал при регистрации.

После того, как каждый участник команды по сбору данных зарегистрируется в
системе nextgis.com_, организатор сбора данных будет иметь список e-mail
участников команды по сбору данных.

Для добавления участников команды в веб ГИС необходимо выполнить следующие действия:

1. Открыть веб ГИС как администратор системы.

.. important::
    Описанные ниже действия требуют прав администратора

2. Откроется главная страница с ресурсами вашей веб-ГИС. Необходимо открыть «Панель управления»:

.. figure:: _static/ngc-stages-001.png
   :name: ngc-stages-001
   :align: center

   Открыть панель пользователя

.. figure:: _static/ngc-stages-002.png
   :name: ngc-stages-002
   :align: center

   Выбрать «Панель управления»

3. В секции «Панель управления» необходимо выбрать ссылку «Проекты Collector»:

.. figure:: _static/ngc-stages-003.png
   :name: ngc-stages-003
   :align: center

   Выбрать «Проекты Collector»

4. Откроется секция «Настройки NextGIS Collector»:

.. figure:: _static/ngc-stages-004.png
   :name: ngc-stages-004
   :align: center

   Общий вид страницы «Настройки NextGIS Collector»

5. Для добавления участника команды по сбору данных в веб ГИС необходимо нажать кнопку «Создать»,
откроется модальное окно «Новый участник». В нем необходимо заполнить необходимые поля.

.. note::
    Рекомендуется заполнять поле «Описание» фамилией и именем участника команды по сбору данных,
    чтобы в дальнейшем иметь данные о пользователях NextGIS Collector в одном месте. В таблице пользователей
    работает поиск, поэтому всегда можно найти участника. Эта особенность становится актуальной при
    большом количестве участников.

.. figure:: _static/ngc-stages-005.png
   :name: ngc-stages-005
   :align: center

   Добавляем нового участника команды по сбору данных

6. В результате выполнения действий этого этапа в вашей веб ГИС будут зарегистрированы участники
команды по сбору данных.

.. figure:: _static/ngc-stages-006.png
   :name: ngc-stages-006
   :align: center

   Пример заполненной таблицы участников команды по сбору данных

Это значит, что пользователи с данными e-mail, смогут при установке
мобильного приложения `NextGIS Collector`_ и успешной авторизации в нем, получить проекты
сбора данных из вашей веб ГИС и начать сбор данных. Однако, в каждом отдельном проекте
вы сможете контролировать доступ различных пользователей. Детальнее, это будет описано ниже.

Организатор сбора данных: создание проекта сбора данных
-------------------------------------------------------

Проект сбора данных - это ресурс в вашей веб ГИС, который представляет собой набор слоев
данных для редактирования. В веб ГИС «проект сбора данных» сокращенно называется «Проект Collector».
Проект сбора данных в дальнейшем загрузит мобильное приложение `NextGIS Collector`_
и предоставляет возможность участнику команды по сбору данных возможность редактировать слои,
содержащиеся в нем. Владелец веб ГИС имеет возможность ограничивать доступ к проекту
отдельным участникам команды по сбору данных.

Предположим, что в нашей веб ГИС уже загружены слои данных и мы хотим создать проект
и предоставить возможность участникам команды по сбору данных собирать или редактировать
уже имеющиеся данные нашей веб ГИС. Для этого необходимо выполнить следующие действия:

1. Открыть веб ГИС.

2. Выбрать в панеле «Создать ресурс» ссылку «Проект Collector»:

.. important::
    Создание проекта сбора данных рекомендуется выполнять администратору веб ГИС.

.. figure:: _static/ngc-stages-007.png
   :name: ngc-stages-007
   :align: center

   Выбор пункта создания ресурса «Проект Collector»

3. Ввести наименование проекта. Это наименование будет доступно в мобильном приложении `NextGIS Collector`_:

.. figure:: _static/ngc-stages-008.png
   :name: ngc-stages-008
   :align: center

4. Далее необходимо открыть вкладку «Проект» и заполнить поля «Вид начального экрана» и
«Данные для входа NextGIS Collector».

«Вид начального экрана» - опция, которая задает стартовый экран в мобильном приложении `NextGIS Collector`_ -
это может быть либо список слоев, либо карта.

«Данные для входа NextGIS Collector» - это имя и пароль пользователя веб ГИС, под которым мобильное приложение
`NextGIS Collector`_, установленное у всех участников вашей команды по сбору данных, будет вносить изменения
в слои вашей веб ГИС.

.. note::
    Для того, чтобы заполнить «Данные для входа NextGIS Collector» рекомендуется предварительно создать нового
    пользователя, предназначенного именно для мобильного приложения `NextGIS Collector`_. Этому пользователю
    необходимо назначить права чтения и записи данных для тех слоев, которые будут находиться в вашем проекте.
    Тогда вы сможете гибко обеспечивать безопасность ваших данных в процессе сбора данных.

.. important::
    Не рекомендуем использовать для заполнения поля «Данные для входа NextGIS Collector» данные пользователя с
    правами Администратора, т.к. в случае утери или перехвата этих данных злоумышленник может получить
    доступ к вашей веб ГИС.

.. figure:: _static/ngc-stages-009.png
   :name: ngc-stages-009
   :align: center

   Внешний вид вкладки «Проект»

5. Следующий этап - добавление необходимых элементов в проект.

Элемент проекта Collector может быть редактируемым слоем данных, слоем данных для только для отображения,
картографической подложкой или формой для сбора данных.

.. note::
            Добавление слоёв PostGIS в проект Collector возможно, но работа с такими слоями на данный момент не поддерживается мобильным приложением NextGIS Collector.

Добавление аналогично добавлению слоев при создании веб-карты - необходимо нажать кнопку «Добавить элемент»
для добавления слоя или формы сбора данных. Кнопка  «Добавить группу» позволяет
создать группу элементов. Внутри дерева элементов работает перетягивание.

.. figure:: _static/ngc-stages-010.png
   :name: ngc-stages-010
   :align: center

   Внешний вид вкладки «Элементы»

Каждый элемент проекта Collector имеет следующие атрибуты:

- «Название» - название слоя, которое будет доступно в мобильном приложении NextGIS Collector.
- «Видимый» - контролирует видимость слоя в в мобильном приложении NextGIS Collector.
- «Редактируемый» - будет ли пользователь мобильного приложения NextGIS Collector иметь возможность редактирования слоя.
- «Синхронизируемый» - будут ли правки слоя синхронизироваться с вашей веб ГИС.
- «Время жизни» - время кеширования тайлов (актуален для тайловых слоев).
- «Минимальный зум» - минимальный зум на котором будет виден слой.
- «Максимальный зум» - максимальный зум на котором будет виден слой.

6. Далее необходимо предоставить доступ необходимым участникам команды сбора данных. На вкладке «Участники»
путем установления галок выбираем тех участников команды по сбору данных, которые должны участвовать в этом проекте:

.. figure:: _static/ngc-stages-011.png
   :name: ngc-stages-011
   :align: center

   Внешний вид вкладки «Участники»

7. Сохраняем проект.

В результате осуществления приведенных выше действий будет создан проект Collector (проект по сбору данных).

Таких проектов в вашей веб ГИС может быть неограниченное количество. В каждом из проектов вы можете ограничивать
или разрешать доступ только определенному набору участников из команды участников по сбору данных.


Участники команды: установка мобильного приложения и начало сбора данных
------------------------------------------------------------------------

Участнику команды по сбору данных для установки мобильного приложения необходимо загрузить
себе на телефон NextGIS Collector. Его можно установить из Google Play Store по ссылке - `NextGIS Collector`_.
Или найти по названию в Google Play Store.

 .. figure:: _static/ngc-user-01.png
   :name: ngc-user-01
   :align: center
   :width: 10cm

   Поиск в Play Market


После установки запустить приложение, пропустить информационные окна и дать необходимые разрешения:


 .. figure:: _static/ngc-user-02.png
   :name: ngc-user-02
   :align: center
   :width: 10cm

   Экран 1


 .. figure:: _static/ngc-user-03.png
   :name: ngc-user-03
   :align: center
   :width: 10cm

   Экран 2


 .. figure:: _static/ngc-user-04.png
   :name: ngc-user-04
   :align: center
   :width: 10cm




 .. figure:: _static/ngc-user-05.png
   :name: ngc-user-05
   :align: center
   :width: 10cm


 .. figure:: _static/ngc-user-06.png
   :name: ngc-user-06
   :align: center
   :width: 10cm

После успешного входа участник команды по сбору данных увидит список проектов.
Предположим, что в Веб ГИС был создан проект по сбору данных с настройкой стартовой страницы в виде списка.
При выборе этого тестового проекта мобильное приложение NextGIS Collector отобразит список слоев.
Также можно переключить в режим карты.

 .. figure:: _static/ngc-user-07.png
   :name: ngc-user-07
   :align: center
   :width: 10cm

   Выберите проект для сбора.

 .. figure:: _static/ngc-user-08.png
   :name: ngc-user-08
   :align: center
   :width: 10cm

   Редактируемые слои проекта

 .. figure:: _static/ngc-user-09.png
   :name: ngc-user-09
   :align: center
   :width: 10cm

   Список слоев проекта в режиме просмотра "Карта"

Участник команды сбора данных может начинать редактирование слоев. Инструменты редактирования
и подхода к редактированию аналогичны используемым в NextGIS Mobile.
